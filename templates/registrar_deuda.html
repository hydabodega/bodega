{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <!-- Added modern header with better styling -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center mb-3">
                <div class="bg-primary rounded-circle p-3 me-3">
                    <i class="bi bi-plus-circle text-white fs-4"></i>
                </div>
                <div>
                    <h2 class="mb-0 text-primary">Registrar Nueva Deuda</h2>
                    <p class="text-muted mb-0">Selecciona un cliente y agrega productos a la deuda</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Improved client selection form with card design -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person me-2"></i>Seleccionar Cliente</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('registrar_deuda') }}">
                        {{ deuda_form.hidden_tag() }}
                        <div class="mb-3">
                            {{ deuda_form.cliente_id.label(class="form-label fw-semibold") }}
                            {{ deuda_form.cliente_id(class="form-select form-select-lg") }}
                        </div>
                        <div class="d-grid">
                            {{ deuda_form.guardar(class="btn btn-success btn-lg") }}
                        </div>
                    </form>
                </div>
            </div>

            <!-- Improved product addition form with better layout -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>Agregar Productos</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('registrar_deuda') }}">
                        {{ producto_form.hidden_tag() }}
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ producto_form.producto_id.label(class="form-label fw-semibold") }}
                                {{ producto_form.producto_id(class="form-select") }}
                            </div>
                            <div class="col-md-4">
                                {{ producto_form.cantidad.label(class="form-label fw-semibold") }}
                                {{ producto_form.cantidad(class="form-control") }}
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                {{ producto_form.agregar(class="btn btn-primary w-100") }}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Added summary card for better UX -->
            <div class="card shadow-sm sticky-top" style="top: 20px;">
                <div class="card-header bg-accent text-white">
                    <h5 class="mb-0"><i class="bi bi-receipt me-2"></i>Resumen de Deuda</h5>
                </div>
                <div class="card-body">
                    {% if productos_deuda %}
                        <div class="mb-3">
                            <small class="text-muted">Total de productos: {{ productos_deuda|length }}</small>
                        </div>
                        <div class="text-center">
                            <div class="display-6 text-primary fw-bold">
                                {% if total is defined and total is number %}
                                    ${{ total|round(2) }}
                                {% else %}
                                    $0.00
                                {% endif %}
                            </div>
                            <small class="text-muted">USD</small>
                        </div>
                    {% else %}
                        <div class="text-center text-muted">
                            <i class="bi bi-cart-x fs-1 mb-3"></i>
                            <p>No hay productos agregados</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Improved products table with better styling -->
    {% if productos_deuda %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Productos en la Deuda</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Producto</th>
                                    <th class="text-center">Cantidad</th>
                                    <th class="text-end">Precio Unit. (USD)</th>
                                    <th class="text-end">Subtotal (USD)</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for producto in productos_deuda %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-primary rounded-circle p-2 me-3">
                                                <i class="bi bi-box text-white"></i>
                                            </div>
                                            <strong>{{ producto.nombre }}</strong>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-info">{{ producto.cantidad }}</span>
                                    </td>
                                    <td class="text-end">
                                        {% if producto.precio is defined and producto.precio is number %}
                                            ${{ producto.precio|round(2) }}
                                        {% else %}
                                            $0.00
                                        {% endif %}
                                    </td>
                                    <td class="text-end fw-bold">
                                        {% if producto.subtotal is defined and producto.subtotal is number %}
                                            ${{ producto.subtotal|round(2) }}
                                        {% else %}
                                            $0.00
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <form method="POST" action="{{ url_for('eliminar_producto_temp', index=loop.index0) }}" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Â¿Eliminar este producto?')">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <td colspan="3" class="text-end fw-bold fs-5">Total:</td>
                                    <td class="text-end fw-bold fs-5 text-primary">
                                        {% if total is defined and total is number %}
                                            ${{ total|round(2) }} USD
                                        {% else %}
                                            $0.00 USD
                                        {% endif %}
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
